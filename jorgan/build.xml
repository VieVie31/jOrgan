<?xml version="1.0" encoding="UTF-8"?>

<project name="jOrgan-core" default="dist" basedir=".">

    <property file="./build.properties"/>

    <target name="dist" description="Set up the distribution" depends="distProgram, distSource, distHelp" />

    <target name="clean" description="Cleanup directories">
        <delete dir="./build"/>
        <delete dir="./help"/>
        <delete dir="./dist"/>
    </target>

    <target name="buildProgram" description="Build the source" >
        <mkdir dir="./build"/>
        <javac debug="false" deprecation="true" destdir="./build" srcdir="./src">
        	<classpath>
	            <fileset dir="./lib">
    	            <include name="*" />
	            </fileset>
        	</classpath>
        </javac>
        <copy todir="./build">
            <fileset dir="./src">
                <include name="META-INF/**/*" />
                <include name="**/*.gif" />
                <include name="**/*.xml" />
                <include name="**/*.xsl" />
            </fileset>
        </copy>
    	<native2ascii encoding="UTF8" src="src" dest="build" includes="**/*.properties" />
    	<copy file="build.properties" tofile="./build/jorgan/app.properties" overwrite="true" />
    </target>

    <target name="distProgram" description="Set up the program distribution" depends="clean, buildProgram" >
        <mkdir dir="./dist/marshal" />

    	<jar destfile="./dist/marshal/jOrgan.jar">
            <fileset dir="./build">
                <include name="**/*"/>
            </fileset>
		    <manifest>
		      	<attribute name="Main-class" value="jorgan.App" />
		      	<attribute name="Class-Path" value="./lib/swingx.jar ./lib/spin.jar ./lib/jh.jar ./lib/creative.jar ./lib/content.jar" />
		    </manifest>
        </jar>

        <mkdir dir="./dist/marshal/lib" />
        <copy file="./lib/swingx.jar" todir="./dist/marshal/lib" />
        <copy file="./lib/spin.jar" todir="./dist/marshal/lib" />

        <mkdir dir="./dist/marshal/docs" />
        <copy todir="./dist/marshal/docs">
            <fileset dir="./docs">
                <include name="*"/>
            </fileset>
		</copy>

        <mkdir dir="./dist/marshal/dispositions" />
        <copy todir="./dist/marshal/dispositions">
            <fileset dir="./dispositions" />
		</copy>

        <zip basedir="./dist/marshal" destfile="./dist/jOrgan-${jorgan.version}.zip" />
        <delete dir="./dist/marshal" />
    </target>

    <target name="distSource" description="Set up the source distribution" depends="clean" >
        <mkdir dir="./dist" />

        <zip basedir="." destfile="./dist/jOrgan-${jorgan.version}-src.zip">
        	<exclude name="build/**/*"/>
        	<exclude name="help/**/*"/>
        	<exclude name="dist/**/*"/>
        </zip>
    </target>

    <target name="buildHelp" description="Set up the help distribution" depends="clean" >
        <mkdir dir="./help" />

    	<java fork="false" classpath="${saxon.path}/saxon.jar" classname="com.icl.saxon.StyleSheet">
    		<arg value="./docs/help/help.xml" />
    		<arg value="${docbook.path}/javahelp/javahelp.xsl" />
    		<arg value="base.dir=./help/" />
    	</java>
    	
    	<java fork="false" classpath="${saxon.path}/saxon.jar" classname="com.icl.saxon.StyleSheet">
    		<arg value="./docs/help/de/help.xml" />
    		<arg value="${docbook.path}/javahelp/javahelp.xsl" />
    		<arg value="base.dir=./help/de/" />
    	</java>
    </target>
    	
    <target name="distHelp" description="Set up the help distribution" depends="clean, buildHelp" >
    	<mkdir dir="./dist/marshal/lib" />
        <copy file="./lib/jh.jar" todir="./dist/marshal/lib" />
        
        <mkdir dir="./dist/marshal/help" />
    	
        <jar destfile="./dist/marshal/help/help.zip">
            <fileset dir="./help">
                <include name="*"/>
                <include name="img/*"/>
            </fileset>
        </jar>

        <jar destfile="./dist/marshal/help/help_de.zip">
            <fileset dir="./help/de">
                <include name="*"/>
                <include name="img/*"/>
            </fileset>
        </jar>

        <zip destfile="./dist/jOrgan-${jorgan.version}-help.zip">
        	<fileset dir="./dist/marshal" >
        		<include name="help/help.zip"/>
        		<include name="lib/*"/>
        	</fileset>
        </zip>	
    	
        <zip destfile="./dist/jOrgan-${jorgan.version}-help_de.zip">
        	<fileset dir="./dist/marshal" >
        		<include name="help/help_de.zip"/>
        		<include name="lib/*"/>
        	</fileset>
        </zip>	

        <delete dir="./dist/marshal" />
    </target>
</project>
